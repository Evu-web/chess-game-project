<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC vs Human Chess (Hopweb Optimized)</title>
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/chessboard-js@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://unpkg.com/chessboard-js@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://unpkg.com/chess.js@0.10.3/chess.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; background-color: #e8e8e8; padding: 20px; margin: 0; }
        #game-container { max-width: 450px; margin: 30px auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
        h1 { color: #333; margin-bottom: 20px; }
        #board-area { margin: 25px auto; display: flex; justify-content: center; }
        #controls { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; margin-bottom: 20px; gap: 10px; }
        #timers { display: flex; justify-content: space-around; font-size: 1.1em; font-weight: bold; color: #444; margin-bottom: 15px; }
        select, button { padding: 8px 12px; border-radius: 5px; border: 1px solid #ccc; font-size: 0.9em; cursor: pointer; }
        #start-game { background-color: #4CAF50; color: white; border: none; font-weight: bold; flex-grow: 1; }
        #game-status { font-size: 1.3em; font-weight: bold; margin-top: 20px; color: #d35400; }
    </style>
</head>
<body>

    <div id="game-container">
        <h1>PC vs Human Chess ♟️</h1>
        
        <div id="controls">
            <label for="time-control">Time:</label>
            <select id="time-control">
                <option value="10">10 Minutes</option>
                <option value="15">15 Minutes</option>
                <option value="20">20 Minutes</option>
            </select>

            <label for="difficulty">Mode:</label>
            <select id="difficulty">
                <option value="2">Normal (Basic AI)</option>
                <option value="3">Hard (Better AI)</option>
                <option value="4">Professional (Advanced AI)</option>
            </select>

            <button id="start-game">Start New Game</button>
        </div>

        <div id="timers">
            <p>Human Time (White): <span id="human-timer">--:--</span></p>
            <p>PC Time (Black): <span id="pc-timer">--:--</span></p>
        </div>

        <div id="board-area">
            <div id="myBoard" style="width: 400px"></div> 
        </div>

        <p id="game-status">Press "Start New Game" to begin.</p>
        <p id="move-count">Moves: Human: 0 | PC: 0</p>
    </div>
    
    <script>
        // --- Game State Variables ---
        var board = null;
        var game = null; 
        
        var statusElement, humanTimerElement, pcTimerElement, moveCountElement; 

        var timerInterval;
        var humanTime, pcTime;
        var humanMoves = 0;
        var pcMoves = 0;
        var aiDepth = 2;

        // --- Helper Functions ---
        function formatTime(totalSeconds) {
            if (totalSeconds < 0) totalSeconds = 0;
            var minutes = Math.floor(totalSeconds / 60);
            var seconds = totalSeconds % 60;
            return (minutes < 10 ? '0' : '') + minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
        }

        // --- Timer Logic ---
        function startTimer(minutes) {
            humanTime = minutes * 60;
            pcTime = minutes * 60;
            humanTimerElement.textContent = formatTime(humanTime);
            pcTimerElement.textContent = formatTime(pcTime);

            clearInterval(timerInterval);
            timerInterval = setInterval(updateTimers, 1000);
        }

        function updateTimers() {
            if (game.game_over()) {
                clearInterval(timerInterval);
                return;
            }
            
            if (game.turn() === 'w') {
                humanTime--;
                humanTimerElement.textContent = formatTime(humanTime);
                if (humanTime <= 0) {
                    clearInterval(timerInterval);
                    declareWinner('time', 'PC');
                }
            } else {
                pcTime--;
                pcTimerElement.textContent = formatTime(pcTime);
                if (pcTime <= 0) {
                    clearInterval(timerInterval);
                    declareWinner('time', 'Human');
                }
            }
        }

        // --- AI (PC) Logic (Placeholder) ---
        function makeAIMove() {
            if (game.game_over()) return;
            
            var possibleMoves = game.moves();
            if (possibleMoves.length === 0) return;

            var randomMove = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
            
            game.move(randomMove);
            board.position(game.fen());
            pcMoves++;
            updateStatus();
            checkGameOver();
        }

        // --- Game Status and Winner Declaration ---
        function updateStatus() {
            var status = '';
            var moveColor = (game.turn() === 'w' ? 'Human (White)' : 'PC (Black)');

            if (game.in_checkmate()) {
                status = 'Game Over! ' + moveColor + ' is checkmated.';
                declareWinner('checkmate', (game.turn() === 'w' ? 'PC' : 'Human'));
            } else if (game.in_draw()) {
                status = 'Game Over! Draw.';
                declareWinner('draw', 'Draw');
            } else {
                status = moveColor + ' to move.';
                if (game.in_check()) {
                    status += ' Check!';
                }
            }

            statusElement.textContent = status;
            moveCountElement.textContent = `Moves: Human: ${humanMoves} | PC: ${pcMoves}`;
        }

        function declareWinner(endReason, winner) {
            clearInterval(timerInterval);
            
            if (endReason === 'time') {
                if (winner === 'Human' && humanMoves > pcMoves) {
                    statusElement.textContent = "Human Wins! (Time + More Moves: " + humanMoves + " vs " + pcMoves + ")";
                } else if (winner === 'PC' && pcMoves > humanMoves) {
                    statusElement.textContent = "PC Wins! (Time + More Moves: " + pcMoves + " vs " + humanMoves + ")";
                } else {
                    statusElement.textContent = `Game Over! ${winner} wins on Time!`;
                }
            } else if (endReason === 'checkmate') {
                statusElement.textContent = `Game Over! ${winner} Wins by Checkmate!`;
            } else if (endReason === 'draw') {
                statusElement.textContent = `Game Over! Draw.`;
            }
        }

        function checkGameOver() {
            if (game.game_over()) {
                clearInterval(timerInterval);
            } else if (game.turn() === 'b') {
                setTimeout(makeAIMove, 500); 
            }
        }

        // --- Board Event Handlers ---
        function onDrop (source, target) {
            if (game.turn() !== 'w') return 'snapback'; 

            var move = game.move({
                from: source,
                to: target,
                promotion: 'q'
            });

            if (move === null) return 'snapback';

            humanMoves++;
            updateStatus();
            checkGameOver();
        }

        // --- Game Initialization Logic ---
        function initGame() {
            // Initialize DOM elements
            statusElement = document.getElementById('game-status');
            humanTimerElement = document.getElementById('human-timer');
            pcTimerElement = document.getElementById('pc-timer');
            moveCountElement = document.getElementById('move-count');

            // 1. Initialize the board object configuration
            var config = {
                draggable: true,
                position: 'start',
                onDrop: onDrop,
                onSnapEnd: function() {
                    board.position(game.fen());
                }
            };
            
            // 2. Initialize the chessboard
            board = Chessboard('myBoard', config);
            
            // Initial setup for timers
            humanTimerElement.textContent = '10:00';
            pcTimerElement.textContent = '10:00';

            // 3. Attach the click handler to the Start New Game button
            document.getElementById('start-game').addEventListener('click', function() {
                // Reset game state
                game = new Chess(); 
                board.start(); 
                humanMoves = 0;
                pcMoves = 0;
                
                // Get settings
                var timeMinutes = parseInt(document.getElementById('time-control').value);
                aiDepth = parseInt(document.getElementById('difficulty').value);
                
                startTimer(timeMinutes);
                updateStatus();
            });
            
            window.addEventListener('resize', board.resize);
        }

        // Wait for the DOM content to be fully loaded before running initGame
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
